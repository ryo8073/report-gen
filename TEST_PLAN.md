# テスト計画

## 🎯 テスト概要

### テスト目的
認証システム付きレポート生成アプリケーションの品質保証と、セキュリティ要件の検証。

### テスト範囲
- 認証機能（登録、ログイン、ログアウト）
- レポート生成機能
- ファイルアップロード機能
- 管理者ダッシュボード
- セキュリティ機能
- 使用状況追跡
- パフォーマンス
- セキュリティ

## 📋 テストケース

### 1. 認証機能テスト

#### 1.1 ユーザー登録テスト

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| AUTH-001 | 正常なユーザー登録 | 新規ユーザー | 1. 登録ページにアクセス<br>2. 有効な情報を入力<br>3. 登録ボタンをクリック | 登録成功、ログインページにリダイレクト |
| AUTH-002 | 重複メールアドレス登録 | 既存ユーザー存在 | 1. 既存メールアドレスで登録試行 | エラーメッセージ表示、登録失敗 |
| AUTH-003 | 弱いパスワード登録 | 新規ユーザー | 1. 弱いパスワードで登録試行 | パスワード要件エラー表示 |
| AUTH-004 | 無効なメールアドレス | 新規ユーザー | 1. 無効なメール形式で登録試行 | メール形式エラー表示 |
| AUTH-005 | 必須項目未入力 | 新規ユーザー | 1. 必須項目を空で登録試行 | 必須項目エラー表示 |

#### 1.2 ユーザーログインテスト

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| AUTH-006 | 正常なログイン | 登録済みユーザー | 1. ログインページにアクセス<br>2. 有効な認証情報を入力<br>3. ログインボタンをクリック | ログイン成功、メインページにリダイレクト |
| AUTH-007 | 無効なパスワード | 登録済みユーザー | 1. 間違ったパスワードでログイン試行 | 認証エラー表示 |
| AUTH-008 | 存在しないユーザー | 未登録ユーザー | 1. 未登録メールアドレスでログイン試行 | 認証エラー表示 |
| AUTH-009 | レート制限 | 複数回失敗 | 1. 5回連続でログイン失敗<br>2. 6回目のログイン試行 | レート制限エラー表示 |
| AUTH-010 | セッション作成 | ログイン成功 | 1. 正常にログイン | セッション作成、HTTP-onlyクッキー設定 |

#### 1.3 ログアウトテスト

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| AUTH-011 | 正常なログアウト | ログイン済みユーザー | 1. ログアウトボタンをクリック | ログアウト成功、ログインページにリダイレクト |
| AUTH-012 | セッション無効化 | ログアウト後 | 1. ログアウト後、APIにアクセス | 認証エラー、ログインページにリダイレクト |
| AUTH-013 | クッキー削除 | ログアウト後 | 1. ログアウト後、クッキー確認 | セッションクッキーが削除される |

### 2. レポート生成機能テスト

#### 2.1 基本レポート生成

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| REPORT-001 | テキストのみレポート生成 | ログイン済みユーザー | 1. テキストを入力<br>2. レポート種別を選択<br>3. 生成ボタンをクリック | レポート生成成功、プレビュー表示 |
| REPORT-002 | ファイル付きレポート生成 | ログイン済みユーザー | 1. PDFファイルをアップロード<br>2. レポート種別を選択<br>3. 生成ボタンをクリック | PDF抽出成功、レポート生成 |
| REPORT-003 | 複数ファイルアップロード | ログイン済みユーザー | 1. 複数ファイルをアップロード<br>2. レポート生成 | 全ファイル処理成功 |
| REPORT-004 | 構造化出力 | ログイン済みユーザー | 1. 構造化出力を選択<br>2. レポート生成 | JSON形式でも出力 |
| REPORT-005 | カスタムプロンプト | ログイン済みユーザー | 1. カスタムプロンプトを入力<br>2. レポート生成 | カスタムプロンプトが反映される |
| REPORT-006 | 比較分析レポート | ログイン済みユーザー | 1. 複数ファイルをアップロード<br>2. 比較分析を選択<br>3. レポート生成 | 比較分析レポートが生成される |
| REPORT-007 | 三つの主要レポート | ログイン済みユーザー | 1. 投資分析（4部構成）を選択<br>2. 税務戦略を選択<br>3. 相続対策を選択 | 各レポートが正常に生成される |

#### 2.2 ファイルアップロードテスト

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| FILE-001 | ドラッグ&ドロップ | ログイン済みユーザー | 1. ファイルをドラッグ&ドロップ | ファイルアップロード成功 |
| FILE-002 | ファイルサイズ制限 | ログイン済みユーザー | 1. 5MBファイルをアップロード試行 | サイズ制限エラー表示 |
| FILE-003 | 対応ファイル形式 | ログイン済みユーザー | 1. PDF、PNG、JPGファイルをアップロード | アップロード成功 |
| FILE-004 | 非対応ファイル形式 | ログイン済みユーザー | 1. TXTファイルをアップロード試行 | 形式エラー表示 |
| FILE-005 | ファイル削除 | アップロード済みファイル | 1. ファイル削除ボタンをクリック | ファイル削除成功 |

### 3. 管理者機能テスト

#### 3.1 ダッシュボード表示

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| ADMIN-001 | 管理者ダッシュボード表示 | 管理者ユーザー | 1. ダッシュボードにアクセス | 統計情報表示 |
| ADMIN-002 | 一般ユーザーの管理者アクセス | 一般ユーザー | 1. 管理者ページにアクセス試行 | 権限エラー、リダイレクト |
| ADMIN-003 | 使用統計表示 | 管理者ユーザー | 1. ダッシュボード表示 | 正確な統計データ表示 |
| ADMIN-004 | 最近のアクティビティ表示 | 管理者ユーザー | 1. アクティビティページ表示 | アクティビティ一覧表示 |

### 4. セキュリティテスト

#### 4.1 認証セキュリティ

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| SEC-001 | パスワードハッシュ化 | ユーザー登録 | 1. パスワード登録<br>2. データベース確認 | パスワードがハッシュ化されて保存 |
| SEC-002 | セッションセキュリティ | ログイン後 | 1. セッション確認 | JWTトークン、HTTP-onlyクッキー |
| SEC-003 | セッション期限 | 期限切れセッション | 1. 期限切れセッションでAPIアクセス | 認証エラー、リダイレクト |
| SEC-004 | レート制限 | 複数回認証失敗 | 1. レート制限テスト | 適切な制限適用 |

#### 4.2 入力検証

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| SEC-005 | XSS攻撃対策 | ログイン済みユーザー | 1. スクリプトタグを含む入力 | 入力サニタイズ、安全な処理 |
| SEC-006 | SQLインジェクション対策 | ログイン済みユーザー | 1. SQLインジェクション試行 | 安全な処理、エラーなし |
| SEC-007 | セキュリティヘッダー | 任意のページ | 1. レスポンスヘッダー確認 | 適切なセキュリティヘッダー設定 |

### 5. パフォーマンステスト

#### 5.1 レスポンス時間

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| PERF-001 | ログイン応答時間 | 登録済みユーザー | 1. ログイン実行<br>2. 応答時間測定 | 2秒以内でログイン完了 |
| PERF-002 | レポート生成時間 | ログイン済みユーザー | 1. レポート生成実行<br>2. 生成時間測定 | 60秒以内でレポート生成 |
| PERF-003 | ファイルアップロード時間 | ログイン済みユーザー | 1. 4MBファイルアップロード<br>2. アップロード時間測定 | 10秒以内でアップロード完了 |

#### 5.2 同時接続テスト

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| PERF-004 | 同時ログイン | 複数ユーザー | 1. 10ユーザーが同時ログイン | 全ユーザーが正常にログイン |
| PERF-005 | 同時レポート生成 | 複数ユーザー | 1. 5ユーザーが同時レポート生成 | 全レポートが正常に生成 |

### 6. 使用状況追跡テスト

#### 6.1 ログ記録

| テストID | テストケース | 前提条件 | 実行手順 | 期待結果 |
|---------|-------------|----------|----------|----------|
| LOG-001 | ログインログ記録 | ユーザーログイン | 1. ログイン実行<br>2. ログ確認 | ログインアクションが記録される |
| LOG-002 | レポート生成ログ記録 | レポート生成 | 1. レポート生成実行<br>2. ログ確認 | レポート生成アクションが記録される |
| LOG-003 | ファイルアップロードログ記録 | ファイルアップロード | 1. ファイルアップロード<br>2. ログ確認 | ファイル統計が記録される |
| LOG-004 | プライバシー保護 | ログ記録 | 1. ログ内容確認 | 個人情報は最小限に抑えられる |

## 🧪 テスト実行計画

### フェーズ1: 単体テスト
- **期間**: 1週間
- **対象**: 各機能の個別テスト
- **担当**: 開発者
- **ツール**: Jest, Mocha

### フェーズ2: 統合テスト
- **期間**: 1週間
- **対象**: 機能間の連携テスト
- **担当**: QAエンジニア
- **ツール**: Postman, Newman

### フェーズ3: セキュリティテスト
- **期間**: 1週間
- **対象**: セキュリティ要件の検証
- **担当**: セキュリティエンジニア
- **ツール**: OWASP ZAP, Burp Suite

### フェーズ4: パフォーマンステスト
- **期間**: 1週間
- **対象**: 負荷・性能テスト
- **担当**: パフォーマンスエンジニア
- **ツール**: Artillery, k6

### フェーズ5: ユーザー受け入れテスト
- **期間**: 1週間
- **対象**: エンドツーエンドテスト
- **担当**: ステークホルダー
- **ツール**: Cypress, Playwright

## 📊 テスト結果管理

### テスト結果記録
- テスト実行日時
- テスト結果（PASS/FAIL）
- 不具合詳細（該当する場合）
- スクリーンショット（該当する場合）
- 修正対応状況

### 不具合管理
- 優先度（High/Medium/Low）
- 影響範囲
- 修正期限
- 再テスト結果

### 品質メトリクス
- テストカバレッジ率
- 不具合密度
- 修正率
- 再テスト率

## 🔧 テスト環境

### 開発環境
- **URL**: http://localhost:3000
- **データベース**: SQLite
- **認証**: テスト用JWTシークレット

### ステージング環境
- **URL**: https://staging.example.com
- **データベース**: PostgreSQL
- **認証**: 本番同等設定

### 本番環境
- **URL**: https://production.example.com
- **データベース**: PostgreSQL
- **認証**: 本番用JWTシークレット

## 📋 テスト完了基準

### 機能テスト
- [ ] 全認証機能が正常動作
- [ ] 全レポート生成機能が正常動作
- [ ] 全管理者機能が正常動作
- [ ] 全セキュリティ機能が正常動作

### パフォーマンステスト
- [ ] ログイン応答時間 ≤ 2秒
- [ ] レポート生成時間 ≤ 60秒
- [ ] 同時接続数 ≥ 50ユーザー
- [ ] メモリ使用量 ≤ 512MB

### セキュリティテスト
- [ ] 認証セキュリティ要件を満たす
- [ ] 入力検証が適切に動作
- [ ] セキュリティヘッダーが設定済み
- [ ] 脆弱性スキャンで問題なし

### 使用状況追跡
- [ ] 全アクションがログ記録される
- [ ] プライバシーが保護される
- [ ] 管理者ダッシュボードが正常動作
- [ ] 統計データが正確に表示される