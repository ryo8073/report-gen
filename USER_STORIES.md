# ユーザーストーリー

## 👤 エンドユーザー（一般ユーザー）

### 認証関連

**US-001: ユーザー登録**
```
As a 新規ユーザー
I want to アカウントを作成できる
So that レポート生成サービスを利用できる

Acceptance Criteria:
- 名前、メールアドレス、パスワードを入力できる
- パスワードは8文字以上で大文字・小文字・数字を含む
- 重複するメールアドレスは登録できない
- 登録成功後、ログインページにリダイレクトされる
```

**US-002: ユーザーログイン**
```
As a 登録済みユーザー
I want to アカウントにログインできる
So that レポート生成サービスにアクセスできる

Acceptance Criteria:
- メールアドレスとパスワードでログインできる
- ログイン成功後、メインページにリダイレクトされる
- 無効な認証情報の場合はエラーメッセージが表示される
- セッションは7日間有効である
```

**US-003: ユーザーログアウト**
```
As a ログイン済みユーザー
I want to セキュアにログアウトできる
So that アカウントのセキュリティを保てる

Acceptance Criteria:
- ログアウトボタンをクリックできる
- ログアウト後、ログインページにリダイレクトされる
- セッションが完全に無効化される
```

### レポート生成関連

**US-004: レポート生成**
```
As a 認証済みユーザー
I want to テキスト・画像・PDFからレポートを生成できる
So that プロフェッショナルな文書を作成できる

Acceptance Criteria:
- レポート種別を選択できる
- テキストを入力できる
- ファイルをアップロードできる（PDF、PNG、JPG）
- 言語を選択できる（日本語/英語）
- 構造化出力を選択できる
- 生成されたレポートをプレビューできる
- レポートをコピー・ダウンロードできる
```

**US-005: ファイルアップロード**
```
As a ユーザー
I want to ファイルをドラッグ&ドロップでアップロードできる
So that 簡単にファイルを添付できる

Acceptance Criteria:
- ドラッグ&ドロップでファイルをアップロードできる
- クリックでファイル選択ダイアログを開ける
- 複数ファイルを同時にアップロードできる
- ファイルサイズ制限（4.5MB）が適用される
- 対応ファイル形式（PDF、PNG、JPG）のみ受け付ける
- アップロードしたファイルを削除できる
```

**US-006: レポート種別選択**
```
As a ユーザー
I want to 目的に応じたレポート種別を選択できる
So that 適切な形式のレポートを生成できる

Acceptance Criteria:
- 投資分析（4部構成）を選択できる
- 税務戦略レポートを選択できる
- 相続対策レポートを選択できる
- カスタムプロンプトを入力できる
- 比較分析レポートを選択できる
- エグゼクティブサマリーを選択できる
- 詳細分析レポートを選択できる
- アクションプランを選択できる
- リスクブリーフを選択できる
```

**US-007: カスタムプロンプト入力**
```
As a ユーザー
I want to 独自のプロンプトや要求を入力できる
So that 特定のニーズに合わせたレポートを生成できる

Acceptance Criteria:
- カスタムプロンプトテキストエリアに入力できる
- 既存のレポート種別と組み合わせて使用できる
- カスタムプロンプトがレポート生成に反映される
- 入力したプロンプトが保存・再利用できる
```

**US-008: 比較分析レポート生成**
```
As a ユーザー
I want to 複数のデータを比較分析できる
So that 相対的な評価や選択肢の比較ができる

Acceptance Criteria:
- 複数のファイルをアップロードして比較できる
- 比較分析レポート種別を選択できる
- 相対的な優劣や特徴を分析できる
- 比較結果を表形式で表示できる
- 推奨事項を含む比較レポートを生成できる
```

## 🔧 管理者

**US-009: システム統計確認**
```
As a 管理者
I want to システムの使用状況を確認できる
So that サービスの健全性を監視できる

Acceptance Criteria:
- 総ユーザー数を確認できる
- 総リクエスト数を確認できる
- 生成レポート数を確認できる
- 総ファイル数を確認できる
- 過去30日の使用状況グラフを確認できる
```

**US-010: ユーザー活動監視**
```
As a 管理者
I want to ユーザーの活動を監視できる
So that セキュリティと使用パターンを把握できる

Acceptance Criteria:
- 最近のアクティビティを確認できる
- ユーザーのログイン履歴を確認できる
- レポート生成履歴を確認できる
- ファイルアップロード統計を確認できる
- 異常な活動パターンを検出できる
```

**US-011: セキュリティ監視**
```
As a 管理者
I want to セキュリティログを確認できる
So that セキュリティインシデントを検出・対応できる

Acceptance Criteria:
- 認証失敗の試行を確認できる
- レート制限の適用状況を確認できる
- セッション管理の状況を確認できる
- 異常なアクセスパターンを検出できる
```

## 🛡️ セキュリティ関連

**US-012: パスワードセキュリティ**
```
As a システム
I want to 強力なパスワードを強制する
So that アカウントのセキュリティを保てる

Acceptance Criteria:
- パスワードは8文字以上である必要がある
- 大文字・小文字・数字を含む必要がある
- パスワードはbcryptでハッシュ化される
- 平文でパスワードを保存しない
```

**US-013: セッションセキュリティ**
```
As a システム
I want to セキュアなセッション管理を提供する
So that ユーザーセッションの安全性を保てる

Acceptance Criteria:
- JWTトークンでセッションを管理する
- HTTP-onlyクッキーでトークンを保存する
- セッションは7日間で期限切れになる
- ログアウト時にセッションを無効化する
```

**US-014: レート制限**
```
As a システム
I want to 認証エンドポイントにレート制限を適用する
So that ブルートフォース攻撃を防げる

Acceptance Criteria:
- 15分間に5回まで認証試行を制限する
- IPアドレスベースで制限を適用する
- 制限超過時は適切なエラーメッセージを返す
- 古い試行は自動的にクリーンアップされる
```

## 📊 使用状況追跡

**US-015: 使用統計記録**
```
As a システム
I want to ユーザーの使用状況を記録する
So that サービス改善と監視ができる

Acceptance Criteria:
- ユーザーアクションをログに記録する
- ファイルアップロード統計を記録する
- レポート生成統計を記録する
- 個人を特定できる情報は最小限にする
```

**US-016: プライバシー保護**
```
As a システム
I want to ユーザーのプライバシーを保護する
So that 個人情報の漏洩を防げる

Acceptance Criteria:
- 使用統計は匿名化される
- 個人を特定できる情報は最小限に収集する
- 管理者のみが統計データにアクセスできる
- データ保持期間を設定できる
```
