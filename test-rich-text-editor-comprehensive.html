<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rich Text Editor Comprehensive Test</title>
    <style>
        :root {
            --color-primary: #3b82f6;
            --color-gray-50: #f9fafb;
            --color-gray-100: #f3f4f6;
            --color-gray-200: #e5e7eb;
            --color-gray-300: #d1d5db;
            --color-gray-400: #9ca3af;
            --color-gray-500: #6b7280;
            --color-gray-600: #4b5563;
            --color-gray-700: #374151;
            --color-gray-800: #1f2937;
            --color-gray-900: #111827;
            --color-red-50: #fef2f2;
            --color-red-200: #fecaca;
            --color-red-500: #ef4444;
            --color-red-600: #dc2626;
            --color-red-700: #b91c1c;
            --color-green-500: #10b981;
            --color-yellow-500: #f59e0b;
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 2rem;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-bottom: 2rem;
            color: var(--color-gray-800);
        }
        
        .test-section {
            margin-bottom: 3rem;
            border: 1px solid var(--color-gray-200);
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .test-editor {
            border: 1px solid var(--color-gray-300);
            border-radius: 6px;
            min-height: 400px;
            margin-bottom: 1rem;
        }
        
        .test-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-gray-300);
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .btn:hover {
            background: var(--color-gray-50);
        }
        
        .btn-primary {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .output {
            padding: 1rem;
            background: var(--color-gray-50);
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--color-gray-200);
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Rich Text Editor Comprehensive Test</h1>
        
        <div class="test-section">
            <h2>Rich Text Editor with Toolbar</h2>
            <div id="richTextEditor" class="test-editor"></div>
            
            <div class="test-controls">
                <button class="btn btn-primary" onclick="initializeEditor()">エディター初期化</button>
                <button class="btn" onclick="setTestContent()">テストコンテンツ設定</button>
                <button class="btn" onclick="getContent()">コンテンツ取得</button>
                <button class="btn" onclick="clearContent()">クリア</button>
                <button class="btn" onclick="testFormatting()">フォーマットテスト</button>
                <button class="btn" onclick="testAccessibility()">アクセシビリティテスト</button>
                <button class="btn" onclick="saveContent()">保存</button>
            </div>
            
            <div id="output" class="output"></div>
        </div>
    </div>

    <script src="lib/formatting-toolbar.js"></script>
    <script src="lib/rich-text-editor.js"></script>
    
    <script>
        let richTextEditor;
        
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        function initializeEditor() {
            const container = document.getElementById('richTextEditor');
            
            try {
                if (richTextEditor) {
                    richTextEditor.destroy();
                }
                
                richTextEditor = new RichTextEditor(container, {
                    enableToolbar: true,
                    enableRealTimePreview: true,
                    enableAutoSave: true,
                    autoSaveInterval: 3000,
                    placeholder: 'ここにテキストを入力してテストしてください...',
                    onContentChange: (content, textContent) => {
                        log(`Content changed: ${textContent.length} characters`);
                    },
                    onAutoSave: (content) => {
                        log('Auto-save triggered');
                    }
                });
                
                log('✓ RichTextEditor initialized successfully');
                
                // Test if editor is ready
                setTimeout(() => {
                    if (richTextEditor.isReady()) {
                        log('✓ Editor is ready for use');
                    } else {
                        log('✗ Editor is not ready');
                    }
                }, 100);
                
            } catch (error) {
                log(`✗ Failed to initialize RichTextEditor: ${error.message}`);
                container.innerHTML = '<div style="padding: 2rem; text-align: center; color: red;">エラー: ' + error.message + '</div>';
            }
        }
        
        function setTestContent() {
            if (!richTextEditor || !richTextEditor.isReady()) {
                log('✗ Editor not initialized');
                return;
            }
            
            const testContent = `
                <h1>テストレポート</h1>
                <h2>概要</h2>
                <p>これは<strong>リッチテキストエディター</strong>のテストコンテンツです。</p>
                <p><em>斜体</em>や<u>下線</u>などの基本的なフォーマットをテストできます。</p>
                <h3>機能一覧</h3>
                <ul>
                    <li>フォントファミリーの変更</li>
                    <li>フォントサイズの調整</li>
                    <li>太字、斜体、下線</li>
                    <li>文字色の変更</li>
                    <li>ハイライト機能</li>
                </ul>
                <p>このエディターは<span style="color: #dc2626;">カラーテキスト</span>と<span style="background-color: #fef08a;">ハイライト</span>もサポートしています。</p>
            `;
            
            richTextEditor.setContent(testContent);
            log('✓ Test content set');
        }
        
        function getContent() {
            if (!richTextEditor || !richTextEditor.isReady()) {
                log('✗ Editor not initialized');
                return;
            }
            
            const content = richTextEditor.getContent();
            const textContent = richTextEditor.getTextContent();
            
            log('HTML Content:');
            log(content);
            log('\nText Content:');
            log(textContent);
            log(`\nStats: ${content.length} HTML chars, ${textContent.length} text chars`);
        }
        
        function clearContent() {
            if (!richTextEditor || !richTextEditor.isReady()) {
                log('✗ Editor not initialized');
                return;
            }
            
            richTextEditor.clear();
            log('✓ Content cleared');
        }
        
        function testFormatting() {
            if (!richTextEditor || !richTextEditor.isReady()) {
                log('✗ Editor not initialized');
                return;
            }
            
            log('Testing formatting capabilities...');
            
            // Test basic formatting
            const testText = 'This is a formatting test.';
            richTextEditor.setContent(`<p>${testText}</p>`);
            
            // Focus editor
            richTextEditor.focus();
            
            // Select all text
            const editor = document.querySelector('.editor-content');
            if (editor) {
                const range = document.createRange();
                range.selectNodeContents(editor);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                log('✓ Text selected for formatting test');
                
                // Test toolbar buttons
                setTimeout(() => {
                    const boldBtn = document.querySelector('[data-action="bold"]');
                    const italicBtn = document.querySelector('[data-action="italic"]');
                    const underlineBtn = document.querySelector('[data-action="underline"]');
                    
                    if (boldBtn) {
                        boldBtn.click();
                        log('✓ Bold button clicked');
                    }
                    
                    setTimeout(() => {
                        if (italicBtn) {
                            italicBtn.click();
                            log('✓ Italic button clicked');
                        }
                        
                        setTimeout(() => {
                            if (underlineBtn) {
                                underlineBtn.click();
                                log('✓ Underline button clicked');
                            }
                            
                            setTimeout(() => {
                                const formattedContent = richTextEditor.getContent();
                                log('Formatted content:');
                                log(formattedContent);
                            }, 100);
                        }, 100);
                    }, 100);
                }, 100);
            }
        }
        
        function testAccessibility() {
            log('Testing accessibility features...');
            
            // Check ARIA attributes
            const editor = document.querySelector('.editor-content');
            if (editor) {
                const role = editor.getAttribute('role');
                const ariaLabel = editor.getAttribute('aria-label');
                const ariaMultiline = editor.getAttribute('aria-multiline');
                const ariaDescribedby = editor.getAttribute('aria-describedby');
                
                log(`✓ Editor role: ${role}`);
                log(`✓ ARIA label: ${ariaLabel}`);
                log(`✓ ARIA multiline: ${ariaMultiline}`);
                log(`✓ ARIA describedby: ${ariaDescribedby}`);
            }
            
            // Check toolbar accessibility
            const toolbar = document.querySelector('.formatting-toolbar');
            if (toolbar) {
                const toolbarRole = toolbar.getAttribute('role');
                const toolbarLabel = toolbar.getAttribute('aria-label');
                
                log(`✓ Toolbar role: ${toolbarRole}`);
                log(`✓ Toolbar label: ${toolbarLabel}`);
                
                // Check button accessibility
                const buttons = toolbar.querySelectorAll('.toolbar-button');
                buttons.forEach((button, index) => {
                    const btnLabel = button.getAttribute('aria-label');
                    const btnPressed = button.getAttribute('aria-pressed');
                    log(`✓ Button ${index + 1}: ${btnLabel}, pressed: ${btnPressed}`);
                });
            }
            
            // Test keyboard shortcuts
            log('Testing keyboard shortcuts...');
            richTextEditor.focus();
            
            // Simulate Ctrl+B
            const boldEvent = new KeyboardEvent('keydown', {
                key: 'b',
                ctrlKey: true,
                bubbles: true
            });
            document.dispatchEvent(boldEvent);
            log('✓ Ctrl+B shortcut tested');
        }
        
        function saveContent() {
            if (!richTextEditor || !richTextEditor.isReady()) {
                log('✗ Editor not initialized');
                return;
            }
            
            richTextEditor.save();
            log('✓ Content saved manually');
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            log('Page loaded, ready to test Rich Text Editor');
            
            // Check if required classes are available
            if (typeof RichTextEditor === 'undefined') {
                log('✗ RichTextEditor class not found');
            } else {
                log('✓ RichTextEditor class available');
            }
            
            if (typeof FormattingToolbar === 'undefined') {
                log('✗ FormattingToolbar class not found');
            } else {
                log('✓ FormattingToolbar class available');
            }
            
            // Auto-initialize
            setTimeout(() => {
                initializeEditor();
            }, 500);
        });
    </script>
</body>
</html>