<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiptap Editor Test - No API Calls</title>
    <link rel="stylesheet" href="/lib/tiptap-editor-styles.css">
    <style>
        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        #editor-container {
            border: 2px solid #ddd;
            border-radius: 4px;
            margin: 20px 0;
        }
        #markdown-output {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }
        .button-group {
            margin: 10px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #0056b3;
        }
        button.secondary {
            background: #6c757d;
        }
        button.secondary:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Tiptap Editor Test (No API Calls)</h1>
        
        <div id="status-container">
            <div class="status info">Tiptapã‚¨ãƒ‡ã‚£ã‚¿ã®èª­ã¿è¾¼ã¿çŠ¶æ³ã‚’ç¢ºèªã—ã¦ã„ã¾ã™...</div>
        </div>
        
        <div class="button-group">
            <button onclick="testLoadTiptap()">1. Tiptapèª­ã¿è¾¼ã¿ç¢ºèª</button>
            <button onclick="testCreateEditor()" class="secondary">2. ã‚¨ãƒ‡ã‚£ã‚¿ä½œæˆ</button>
            <button onclick="testMarkdownInput()" class="secondary">3. Markdownå…¥åŠ›ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testMarkdownOutput()" class="secondary">4. Markdownå‡ºåŠ›ãƒ†ã‚¹ãƒˆ</button>
        </div>
    </div>
    
    <div class="test-container">
        <h2>ã‚¨ãƒ‡ã‚£ã‚¿ (TiptapEditorClean)</h2>
        <div id="editor-container"></div>
    </div>
    
    <div class="test-container">
        <h2>Markdownå‡ºåŠ›ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼‰</h2>
        <div id="markdown-output">ã‚¨ãƒ‡ã‚£ã‚¿ãŒåˆæœŸåŒ–ã•ã‚Œã‚‹ã¾ã§å¾…ã£ã¦ã„ã¾ã™...</div>
    </div>
    
    <div class="test-container">
        <h2>ãƒ†ã‚¹ãƒˆç”¨Markdownï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ç”¨ï¼‰</h2>
        <textarea id="test-markdown" style="width: 100%; height: 200px; font-family: monospace; padding: 10px;">
# æŠ•è³‡åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## 1. Executive Summaryï¼ˆæŠ•è³‡æ¦‚è¦ï¼‰

ã“ã®æŠ•è³‡æ¡ˆä»¶ã¯ã€**æ„›çŸ¥çœŒå°ç‰§å¸‚ã®ã‚»ãƒ³ãƒˆãƒãƒ«ãƒ™ãƒªãƒ¼**ã¨ã„ã†ç‰©ä»¶ã«é–¢ã™ã‚‹æŠ•è³‡åˆ†æã§ã™ã€‚

### åˆæœŸåˆ†æ

**ç·åç›Šç‡(FCR)**: 5.06%
**ãƒ­ãƒ¼ãƒ³å®šæ•°(K%)**: 5.06%
**ã‚¤ãƒ¼ãƒ«ãƒ‰ã‚®ãƒ£ãƒƒãƒ—**: 0.00% (FCR - K%)

### å…¨ä½“åˆ†æ

- **ç¨å¼•å‰IRR (èè³‡åˆ©ç”¨æ™‚)**: 7.24%
- **ç¨å¼•å¾ŒIRR (èè³‡åˆ©ç”¨æ™‚)**: 5.39%
- **ç¨å¼•å‰IRR (å…¨é¡è‡ªå·±è³‡é‡‘æ™‚)**: 4.07%
- **ç¨å¼•å¾ŒIRR (å…¨é¡è‡ªå·±è³‡é‡‘æ™‚)**: 3.29%

| é …ç›® | èè³‡åˆ©ç”¨æ™‚ | å…¨é¡è‡ªå·±è³‡é‡‘æ™‚ |
|------|------------|----------------|
| ç¨å¼•å‰IRR | 7.24% | 4.07% |
| ç¨å¼•å¾ŒIRR | 5.39% | 3.29% |
        </textarea>
        <div class="button-group">
            <button onclick="loadTestMarkdown()">ãƒ†ã‚¹ãƒˆMarkdownã‚’ã‚¨ãƒ‡ã‚£ã‚¿ã«èª­ã¿è¾¼ã‚€</button>
        </div>
    </div>

    <!-- Load TiptapEditorClean -->
    <script type="module">
        import TiptapEditorClean from '/lib/tiptap-editor-clean.js';
        
        window.TiptapEditorClean = TiptapEditorClean;
        window.editorInstance = null;
        
        // Global functions for testing
        window.testLoadTiptap = function() {
            const statusContainer = document.getElementById('status-container');
            
            if (typeof TiptapEditorClean === 'undefined') {
                statusContainer.innerHTML = `
                    <div class="status error">âŒ TiptapEditorCleanãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“</div>
                    <div class="status info">ç¢ºèªäº‹é …:</div>
                    <ul>
                        <li>/lib/tiptap-editor-clean.js ãŒå­˜åœ¨ã™ã‚‹ã‹</li>
                        <li>ES Moduleså½¢å¼ã§æ­£ã—ãã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹</li>
                        <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹</li>
                    </ul>
                `;
                return;
            }
            
            statusContainer.innerHTML = `
                <div class="status success">âœ… TiptapEditorCleanãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ</div>
                <div class="status info">
                    <strong>ç¢ºèªæ¸ˆã¿:</strong><br>
                    - TiptapEditorCleanã‚¯ãƒ©ã‚¹: ${typeof TiptapEditorClean !== 'undefined' ? 'åˆ©ç”¨å¯èƒ½' : 'æœªèª­ã¿è¾¼ã¿'}<br>
                    - ã‚°ãƒ­ãƒ¼ãƒãƒ«å‚ç…§: ${typeof window.TiptapEditorClean !== 'undefined' ? 'è¨­å®šæ¸ˆã¿' : 'æœªè¨­å®š'}
                </div>
            `;
        };
        
        window.testCreateEditor = async function() {
            const statusContainer = document.getElementById('status-container');
            const editorContainer = document.getElementById('editor-container');
            
            if (!editorContainer) {
                statusContainer.innerHTML = '<div class="status error">âŒ ã‚¨ãƒ‡ã‚£ã‚¿ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            if (typeof TiptapEditorClean === 'undefined') {
                statusContainer.innerHTML = '<div class="status error">âŒ TiptapEditorCleanãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšã€Œ1. Tiptapèª­ã¿è¾¼ã¿ç¢ºèªã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</div>';
                return;
            }
            
            try {
                statusContainer.innerHTML = '<div class="status info">ã‚¨ãƒ‡ã‚£ã‚¿ã‚’ä½œæˆä¸­...</div>';
                
                // Clear previous editor
                editorContainer.innerHTML = '';
                if (window.editorInstance) {
                    window.editorInstance.destroy();
                }
                
                // Create new editor
                window.editorInstance = new TiptapEditorClean(editorContainer, {
                    enableToolbar: true,
                    enableAutoSave: false,
                    placeholder: 'ã“ã“ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’ç·¨é›†ã—ã¦ãã ã•ã„...',
                    onContentChange: (html, text) => {
                        console.log('[Test] Content changed (HTML length:', html.length, ', Text length:', text.length, ')');
                    },
                    onMarkdownChange: (markdown) => {
                        console.log('[Test] Markdown changed (length:', markdown.length, ')');
                        document.getElementById('markdown-output').textContent = markdown;
                    }
                });
                
                // Wait for initialization
                let attempts = 0;
                const checkReady = setInterval(() => {
                    attempts++;
                    if (window.editorInstance && window.editorInstance.isReady()) {
                        clearInterval(checkReady);
                        statusContainer.innerHTML = `
                            <div class="status success">âœ… ã‚¨ãƒ‡ã‚£ã‚¿ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸ</div>
                            <div class="status info">
                                <strong>ã‚¨ãƒ‡ã‚£ã‚¿çŠ¶æ…‹:</strong><br>
                                - åˆæœŸåŒ–å®Œäº†: ${window.editorInstance.isInitialized ? 'ã¯ã„' : 'ã„ã„ãˆ'}<br>
                                - ã‚¨ãƒ‡ã‚£ã‚¿ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: ${window.editorInstance.editor ? 'å­˜åœ¨' : 'ãªã—'}<br>
                                - æº–å‚™å®Œäº†: ${window.editorInstance.isReady() ? 'ã¯ã„' : 'ã„ã„ãˆ'}
                            </div>
                        `;
                    } else if (attempts > 50) {
                        clearInterval(checkReady);
                        statusContainer.innerHTML = `
                            <div class="status error">âŒ ã‚¨ãƒ‡ã‚£ã‚¿ã®åˆæœŸåŒ–ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ</div>
                            <div class="status info">ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>
                        `;
                    }
                }, 100);
                
            } catch (error) {
                statusContainer.innerHTML = `
                    <div class="status error">âŒ ã‚¨ãƒ‡ã‚£ã‚¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ</div>
                    <div class="status info">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>
                    <div class="status info">ã‚¹ã‚¿ãƒƒã‚¯: ${error.stack}</div>
                `;
                console.error('Editor creation error:', error);
            }
        };
        
        window.testMarkdownInput = function() {
            if (!window.editorInstance) {
                alert('ã¾ãšã€Œ2. ã‚¨ãƒ‡ã‚£ã‚¿ä½œæˆã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
                return;
            }
            
            const testMarkdown = document.getElementById('test-markdown').value;
            
            try {
                window.editorInstance.setContent(testMarkdown, 'markdown');
                
                const statusContainer = document.getElementById('status-container');
                statusContainer.innerHTML = `
                    <div class="status success">âœ… Markdownã‚’ã‚¨ãƒ‡ã‚£ã‚¿ã«è¨­å®šã—ã¾ã—ãŸ</div>
                    <div class="status info">
                        <strong>ç¢ºèª:</strong><br>
                        - Markdownæ§‹æ–‡ï¼ˆ#, **ãªã©ï¼‰ã¯è¡¨ç¤ºã•ã‚Œãšã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸè¦‹ãŸç›®ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™<br>
                        - è¦‹å‡ºã—ã€å¤ªå­—ã€ãƒªã‚¹ãƒˆã€ãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„
                    </div>
                `;
            } catch (error) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
                console.error('Markdown input error:', error);
            }
        };
        
        window.testMarkdownOutput = function() {
            if (!window.editorInstance) {
                alert('ã¾ãšã€Œ2. ã‚¨ãƒ‡ã‚£ã‚¿ä½œæˆã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                const markdown = window.editorInstance.getMarkdown();
                document.getElementById('markdown-output').textContent = markdown;
                
                const statusContainer = document.getElementById('status-container');
                statusContainer.innerHTML = `
                    <div class="status success">âœ… Markdownå‡ºåŠ›ã‚’å–å¾—ã—ã¾ã—ãŸ</div>
                    <div class="status info">
                        <strong>å‡ºåŠ›é•·:</strong> ${markdown.length} æ–‡å­—<br>
                        <strong>ç¢ºèª:</strong> ä¸‹ã®ã€ŒMarkdownå‡ºåŠ›ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„
                    </div>
                `;
            } catch (error) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
                console.error('Markdown output error:', error);
            }
        };
        
        window.loadTestMarkdown = function() {
            if (!window.editorInstance) {
                testCreateEditor();
                setTimeout(() => loadTestMarkdown(), 2000);
                return;
            }
            testMarkdownInput();
        };
        
        // Auto-check on load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                testLoadTiptap();
            }, 500);
        });
    </script>
</body>
</html>

