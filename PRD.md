# PRD.md

## 製品名

クライアント向けレポート生成（日本語優先・認証付き）

## サマリー

認証システム付きのレポート生成アプリ。ユーザー登録・ログイン機能により使用状況を追跡し、テキスト/画像/PDFからOpenAI APIで日本語レポートを生成。プロンプトはサーバ側にのみ保持し、セキュアなユーザー管理を実装。

## 目的・ゴール

* 秘密のテンプレートを守りつつ、均質なレポートを高速生成。
* ユーザー認証による使用状況の追跡・管理。
* 入力は最小（貼付/アップロード/選択/生成）。
* 画像（PNG/JPG）/PDFテキスト抽出に対応。
* 日本語 UI/出力を既定とし、ENは任意切替。
* セキュアなユーザー管理と使用統計の提供。

## 成功指標

* Time-to-Document (TTD) ≤ 60s @ P95（3ファイル以内）。
* 一発採用率（編集なしで社外提出）≥ 70%。
* 週次アクティブ成長 ≥ 15%（6週）。
* ユーザー登録率 ≥ 80%（初回訪問者の）。
* セキュリティインシデント 0件。

## スコープ（MVP）

### 認証システム
* ユーザー登録・ログイン機能（bcrypt + JWT）。
* セッション管理（HTTP-only cookies）。
* レート制限（認証エンドポイント）。
* セキュリティヘッダー実装。

### レポート生成
* フロント：認証付き`index.html` + ビルド済み`styles.css`。
* バック：認証必須`/api/generate`（Nodeサーバレス）。
* PDF抽出、画像の data URL 添付、Responses API 呼び出し。
* 構造化出力（任意ON）。

### 使用状況追跡
* ユーザーアクションのログ記録。
* ファイルアップロード統計。
* 管理者ダッシュボード。
* 匿名化された使用統計。

### セキュリティ
* パスワード強度検証。
* セッション無効化機能。
* 入力検証・サニタイゼーション。
* 使用状況の監査ログ。

## 非スコープ（MVP）

* 大容量アップロード（→ 後続で Vercel Blob）。
* 多要素認証（MFA）。
* ソーシャルログイン。
* ユーザー権限の細分化。

## リスク

* モデルのばらつき → 構造化出力 + レンダラー。
* 大型PDF → 抽出失敗時のガード文。
* PII → レダクション前処理。
* セキュリティ → 強力な認証・暗号化実装。
* データ漏洩 → 最小限の個人情報収集。

## 技術要件

### 認証・セキュリティ
* bcrypt（salt rounds: 12）によるパスワードハッシュ化。
* JWT セッショントークン（7日間有効）。
* HTTP-only クッキーによるセッション管理。
* レート制限（15分間に5回まで）。
* セキュリティヘッダー（XSS、CSRF対策）。

### データベース
* SQLite（開発）/ PostgreSQL（本番推奨）。
* ユーザー情報、セッション、使用ログの管理。
* インデックス最適化による高速クエリ。

### 使用状況追跡
* 匿名化された使用統計。
* ファイルアップロード数・サイズ。
* レポート生成頻度。
* 管理者向けダッシュボード。

## ユーザー体験

### 新規ユーザー
1. 登録ページでアカウント作成。
2. 強力なパスワード設定。
3. メール確認（将来実装）。
4. レポート生成開始。

### 既存ユーザー
1. ログインページで認証。
2. パーソナライズされたダッシュボード。
3. 使用履歴の確認。
4. セキュアなログアウト。

### 管理者
1. 専用ダッシュボードアクセス。
2. システム使用統計の確認。
3. ユーザー活動の監視。
4. セキュリティログの分析。
